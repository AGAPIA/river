<!DOCTYPE html>
<html>
    <head>
        <title>Debugger Demo</title>

        <script src="DockSpawn/js/dockspawn.js"></script>
        
        <link rel="stylesheet" type="text/css" href="dt/DataTables-1.10.10/css/jquery.dataTables.css"/>
        <link rel="stylesheet" type="text/css" href="dt/ColReorder-1.3.0/css/colReorder.dataTables.css"/>
        <link rel="stylesheet" type="text/css" href="dt/FixedHeader-3.1.0/css/fixedHeader.dataTables.css"/>
        <link rel="stylesheet" type="text/css" href="dt/Responsive-2.0.0/css/responsive.dataTables.css"/>
        <link rel="stylesheet" type="text/css" href="dt/Scroller-1.4.0/css/scroller.dataTables.css"/>
        <link rel="stylesheet" type="text/css" href="dt/Select-1.1.0/css/select.dataTables.css"/>
         
        <script src="dt/jQuery-2.1.4/jquery-2.1.4.js"></script>
        <script src="dt/DataTables-1.10.10/js/jquery.dataTables.js"></script>
        <script src="dt/ColReorder-1.3.0/js/dataTables.colReorder.js"></script>
        <script src="dt/FixedHeader-3.1.0/js/dataTables.fixedHeader.js"></script>
        <script src="dt/Responsive-2.0.0/js/dataTables.responsive.js"></script>
        <script src="dt/Scroller-1.4.0/js/dataTables.scroller.js"></script>
        <script src="dt/Select-1.1.0/js/dataTables.select.js"></script>


        <link rel="stylesheet" href="AcidJs.Ribbon.CustomStylesTool.css" />
        <link rel="stylesheet" href="AcidJs.Ribbon.MyCustomDropdown.css" />
        <link rel="stylesheet" href="DockSpawn/css/font-awesome.css" />
        <link rel="stylesheet" href="DockSpawn/css/dock-manager.css" />
        <link rel="stylesheet" href="DockSpawn/css/demo.css" />
        <!--<link rel="stylesheet" href="slick.grid.css" />
        <link rel="stylesheet" href="slick-default-theme.css" />-->

        <script src="capstone.min.js" ></script>

        <script src="MemoryModel.js" ></script>
        <script src="MemoryView.js" ></script>
        <script src="CodeView.js" ></script>
        <script src="model.js" ></script>
        
        <script src="Disassembler.js" ></script>
        

        <!--<script src="jquery-2.1.4.js" ></script>
        <script src="jquery.event.drag-2.2.js" ></script>
        <script src="jquery-ui.js" ></script>-->



        <!--<script src="slick.core.js" ></script>
        <script src="slick.rowselectionmodel.js" ></script>
        <script src="slick.grid.js" ></script>

        <script src="ResizeSensor.js"></script>-->

        <style>
* {
  margin: 0;
  padding: 0;
}

html, body {
    height: 100%;

    margin: 0; padding: 0; overflow: hidden;
}

td {
    white-space: nowrap;
}

.app {
    left: 0;
    top: 0;

    border: solid 1px #555;
}

.topcorner {
    position: absolute;
    top: 1px;
    right: 1px;
}

.dec-button {
    width: 12px;
    height: 12px;
    display:inline-block;
    margin-top:3px;
}

.close-button {
    width: 40px;
    height: 20px;
    display:inline-block;
    text-align: center;
    color: white;
    background-color: red;
}

.bar-button {
    width: 20px;
    height: 20px;
    display:inline-block;
    text-align: center;
    vertical-align:middle;
}

.ribbon-whitespace {
    -webkit-app-region: drag;
}

.no-drag {
    -webkit-app-region: no-drag;
}

.my-custom-style-file-path {
    display:inline-block;
}

.small-text {
    font-size: .7em;
    color: #3b3b3b;
}

#registers_window {
    font-family: Consolas, monospace;
    overflow-y: auto;
}

#registers_window div {
    display:inline-block;
    margin-left: 8px;
    margin-right: 4px;
}

#address_space_window {
    font-family: Consolas, monospace;
}

.memory-view-window {
    font-family: Consolas, monospace;
}

.code-view-window {
    font-family: Consolas, monospace;
}

.modules-window {
    font-family: Consolas, monospace;
}

.breakpoints-window {
    font-family: Consolas, monospace;
}

.breakpoints-window {
    font-family: Consolas, monospace;
}

.inspector-window {
    background: #FFF;
    font-family: Consolas, monospace;
}

.bkp-class {
    color: #F90;
}

input, input:focus {
    box-sizing: border-box;
    border: solid 1px #CCC;
    -webkit-user-select: all;
    height: 24px;
    padding: 0px;
    outline:none;
}

.dataTables_wrapper {
    height:100%;
}

.dataTables_wrapper.no-footer .dataTables_scrollBody {
    border-bottom: 0px solid #FFF !important;
}


.dataTables_scroll {
    height:100%;
}

        </style>
    </head>
<body>
        <script>
var gui = require('nw.gui');
        

function CloseWindow() {
    gui.App.closeAllWindows();
}

var ToggleWindow = function() {
    var maximized = false;

    return function() {
        if (maximized) {
            gui.Window.get().unmaximize();
        } else {
            gui.Window.get().maximize();
        }

        maximized = !maximized;
    }
}();


function MinimizeWindow() {
    gui.Window.get().minimize();
}

        </script>

    <div class="app">
        <div id="ribbon-01"><!-- / --></div>
        <div id="docking" class="my-dock-manager"></div>

        <div class="topcorner">
            <div id="minimize-button" class="no-drag bar-button" onclick="MinimizeWindow()"><i class="fa fa-minus dec-button"></i></div>
            <div id="maximize-button" class="no-drag bar-button" onclick="ToggleWindow()"><i class="fa fa-clone dec-button"></i></div>
            <div id="close-button" class="no-drag close-button"  onclick="CloseWindow()"><i class="fa fa-times dec-button"></i></div>
        </div>
        
        <div id="modules_window" caption="Modules" class="modules-window" onresize="ResizeModules(this)">
            <!--<div id="modulesGrid" style="width:100%; height:100%"> </div>-->

            <table id="modulesGrid" class="display compact" cellspacing="0" width="100%"> </table>
        </div>

        <script>
            function ResizeModules(parent) {
                modulesGrid.fnAdjustColumnSizing(true);
                var st = modulesGrid.fnSettings();

                st.oScroll.sY = (parent.clientHeight - 28) + "px";
                modulesGrid.fnDraw();
            }

            var modulesGrid = (function () {
                function PrintHex(value) {
                    return ("00000000" + (value >>> 0).toString(16)).substr(-8);
                }

                var modulesGrid = $('#modulesGrid');

                modulesGrid.DataTable({
                    "paging" : false,
                    "order": [[ 2, "asc" ]],
                    "scrollY" : "calc(100% - 28px)",
                    //"dom" : '<"fixed_height"t>',
                    "dom" : "t",
                    /*"responsive" : {
                        "details" : false
                    },*/
                    "deferRender" : true,
                    "data" : demoModel.GetModules(),
                    "language": {
                        "emptyTable": "",
                        "infoEmpty": "",
                        "zeroRecords": ""
                    },
                    "columns" : [
                        { 
                            "title" : "Module Name", 
                            "data" : "name" 
                        }, { 
                            "title" : "Address", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintHex(row.moduleBase);
                                    default :
                                        return row.moduleBase;
                                };
                            }
                        }, { 
                            "title" : "Size", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintHex(row.size);
                                    default :
                                        return row.size;
                                };
                            }
                        }
                    ]
                });

                return modulesGrid.dataTable();
             })();
        </script>

        <div id="address_space_window" caption="Address Space" class="address-space-window" onresize="ResizeAddressSpace(this)">
            <table id="memoryGrid" class="display compact" cellspacing="0" width="100%"> </table>
        </div>

        <script>
            function ResizeAddressSpace(parent) {
                memoryGrid.fnAdjustColumnSizing(true);
                var st = memoryGrid.fnSettings();

                st.oScroll.sY = (parent.clientHeight - 28) + "px";
                memoryGrid.fnDraw();
            }

            var memoryGrid = (function () {
                function PrintHex(value) {
                    return ("00000000" + (value >>> 0).toString(16)).substr(-8);
                }

                function MemoryState(value) {
                    var ret = "";
                    if (0x10000 & value) {
                        ret += "free ";
                    }

                    if (0x2000 & value) {
                        ret += "reserved ";
                    }

                    if (0x1000 & value) {
                        ret += "commit";
                    }
                    return ret;
                }

                function MemoryProtection(value) {
                    var ret = "";

                    var names = [
                        "     ",
                        "R    ",
                        "RW   ",
                        "RW+  ",
                        "X    ",
                        "RX   ",
                        "RWX  ",
                        "RW+X ",
                        
                        "", "", "", "", "", "", "", "",
                        "", "", "", "", "", "", "", "",

                        "", "", "", "", "", "", "?", ""
                    ];


                    for (var p = 0; p <= 31; ++p) {
                        if (value & (1 << p)) {
                            ret += names[p];
                        }
                    }

                    ret += "(" + PrintHex(value) + ")";
                    return ret;
                }

                function MemoryType(value) {
                    var ret = "";
                    if (0x1000000 & value) {
                        ret += "image ";
                    }

                    if (0x40000 & value) {
                        ret += "mapped ";
                    }

                    if (0x20000 & value) {
                        ret += "private";
                    }
                    return ret;
                }

                var memoryGrid = $('#memoryGrid');

                memoryGrid.DataTable({
                    "paging" : false,
                    "scrollY" : "calc(100% - 28px)",
                    //"dom" : '<"fixed_height"t>',
                    "dom" : "t",
                    /*"responsive" : {
                        "details" : false
                    },*/
                    "deferRender" : true,
                    "data" : demoModel.GetMemoryMap(),
                    "language": {
                        "emptyTable": "",
                        "infoEmpty": "",
                        "zeroRecords": ""
                    },
                    "columns" : [
                        { 
                            "title" : "Address", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintHex(row.baseAddress);
                                    default :
                                        return row.baseAddress;
                                };
                            }
                        }, { 
                            "title" : "Size", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintHex(row.regionSize);
                                    default :
                                        return row.regionSize;
                                };
                            }
                        }, { 
                            "title" : "State", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return MemoryState(row.state);
                                    default :
                                        return row.state;
                                };
                            }
                        }, { 
                            "title" : "Protection", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return MemoryProtection(row.protection);
                                    default :
                                        return row.state;
                                };
                            }
                        }, { 
                            "title" : "Type", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return MemoryType(row.type);
                                    default :
                                        return row.state;
                                };
                            }
                        }
                    ]
                });

                return memoryGrid.dataTable();
             })();
            /*var memoryGrid = (function () {
                memoryGrid.onDblClick.subscribe(function (event, args) {
                    //alert(args.grid.getDataItem(args.row));
                    var row = args.grid.getDataItem(args.row);

                    if (row.state == 0x1000) { // commited
                        if (row.protection & 0xF0) { //code view
                            var mdl = demoModel.CreateCodeView(row.baseAddress, row.regionSize);

                            if (null != mdl) {
                                var cnt = new dockspawn.PanelContainer(mdl.container, dockManager);
                                var tmp = dockManager.dockFill(dockManager.context.model.documentManagerNode, cnt);

                                mdl.memoryGrid.resizeCanvas();

                                var rsz = new ResizeSensor(mdl.container, function() {
                                    mdl.memoryGrid.resizeCanvas();
                                });

                                //demoModel.UpdateMemoryModel();
                            }
                        } else {
                            var mdl = demoModel.CreateMemoryView(row.baseAddress, row.regionSize);

                            if (null != mdl) {
                                var cnt = new dockspawn.PanelContainer(mdl.container, dockManager);
                                var tmp = dockManager.dockFill(dockManager.context.model.documentManagerNode, cnt);

                                mdl.memoryGrid.resizeCanvas();

                                var rsz = new ResizeSensor(mdl.container, function() {
                                    mdl.memoryGrid.resizeCanvas();
                                });

                                //demoModel.UpdateMemoryModel();
                            }
                        }
                    }
                }); 

                var rsz = new ResizeSensor(document.getElementById("address_space_window"), function() {
                    memoryGrid.resizeCanvas();
                });

                
                return memoryGrid;
             })();*/
        </script>
        
        <div id="registers_window" caption="Registers" class="registers-window">
            <div>EAX:<span id="reg_eax" class="reg-disabled">00000000</span></div>
            <div>ECX:<span id="reg_ecx" class="reg-disabled">00000000</span></div>
            <div>EDX:<span id="reg_edx" class="reg-disabled">00000000</span></div>
            <div>EBX:<span id="reg_ebx" class="reg-disabled">00000000</span></div>
            <div>ESP:<span id="reg_esp" class="reg-disabled">00000000</span></div>
            <div>EBP:<span id="reg_ebp" class="reg-disabled">00000000</span></div>
            <div>ESI:<span id="reg_esi" class="reg-disabled">00000000</span></div>
            <div>EDI:<span id="reg_edi" class="reg-disabled">00000000</span></div>
            <hr />
            <div>FLG:<span id="reg_eflags" class="reg-disabled">00000000</span></div>
            <hr />
            <div>EIP:<span id="reg_eip" class="reg-disabled">00000000</span></div>
        </div>

        <div id="breakpoints_window" caption="Breakpoints" class="breakpoints-window" onresize="ResizeBreakpoint(this)">
            <div style="box-sizing:border-box; padding-bottom:24px; height:100%">
                <table id="breakpointGrid" class="display compact" cellspacing="0" width="100%"> </table>
            </div>
            <input id="breakpoint_input" type="text" style="width:100%; position:relative; top:-24px" onkeydown="if (event.keyCode == 13) AddBreakpoint()" />            
        </div>
        <script>
            function AddBreakpoint() {
                var element = document.getElementById("breakpoint_input");
                
                if (demoModel.CreateBreakpoint(element.value)) {
                    element.value = "";
                }
            }

            function ResizeBreakpoint(parent) {
                breakpointGrid.fnAdjustColumnSizing(true);
                var st = breakpointGrid.fnSettings();

                st.oScroll.sY = (parent.clientHeight - 28 - 24) + "px";
                breakpointGrid.fnDraw();
            }

            var breakpointGrid = (function () {
                function PrintHex(value) {
                    return ("00000000" + (value >>> 0).toString(16)).substr(-8);
                }

                function PrintAddress(dataContext) {
                    if (dataContext.state == "bound") {
                        return PrintHex(dataContext.base + dataContext.offset);
                    }

                    return "N/A";
                }

                function PrintState(value) {
                    switch (value) {
                        case "bound" :
                            return '<i class="fa fa-circle bkp-class"></i>';
                        case "unbound" :
                            return '<i class="fa fa-circle-o bkp-class"></i>';
                    };
                }

                var breakpointGrid = $('#breakpointGrid');

                breakpointGrid.DataTable({
                    "paging" : false,
                    "scrollY" : "calc(100% - 28px)",
                    //"dom" : '<"fixed_height"t>',
                    "dom" : "t",
                    /*"responsive" : {
                        "details" : false
                    },*/
                    "deferRender" : true,
                    "data" : demoModel.GetBreakpoints(),
                    "language": {
                        "emptyTable": "",
                        "infoEmpty": "",
                        "zeroRecords": ""
                    },
                    "columns" : [
                        { 
                            "title" : "State", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintState(row.state);
                                    default :
                                        return row.state;
                                };
                            }
                        }, { 
                            "title" : "Espression", 
                            "data" : "str"
                        }, { 
                            "title" : "Address", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintAddress(row);
                                    default :
                                        return row;
                                };
                            }
                        }
                    ]
                });

                return breakpointGrid.dataTable();

            })();

            /*var breakpointGrid = (function () {
                function PrintHex(value) {
                    return ("00000000" + (value >>> 0).toString(16)).substr(-8);
                }

                function PrintAddress(row, cell, value, columnDef, dataContext) {
                    if (dataContext.state == "bound") {
                        return PrintHex(dataContext.base + dataContext.addr);
                    }

                    return "N/A";
                }

                var columns = [
                    {
                        id: "state", 
                        name: "State", 
                        field: "state", 
                        sortable: true,
                        width: 30,
                        minWidth: 30
                    }, {
                        id: "value", 
                        name: "Expression", 
                        field: "str", 
                        sortable: true,
                        width: 100,
                        minWidth: 100
                    }, {
                        id: "address", 
                        name: "Address", 
                        formatter: PrintAddress,
                        sortable: true,
                        width: 80,
                        minWidth: 80
                    }
                ];

                var options = {
                    enableCellNavigation: true,
                    enableColumnReorder: true,
                    fullWidthRows: true,
                    forceFitColumns: true,
                    headerRowHeight: 22,
                    rowHeight: 22,
                    syncColumnCellResize: false
                };

                var breakpointGrid = new Slick.Grid("#breakpointGrid", demoModel.GetBreakpoints(), columns, options);

                //var rsz = new ResizeSensor(document.getElementById("breakpoints_window"), function() {
                    //breakpointGrid.resizeCanvas();
                //});

                breakpointGrid.setSelectionModel(new Slick.RowSelectionModel());

                return breakpointGrid;
             })();*/
        </script>
        <div id="waypoints_window" caption="Waypoints" class="waypoints-window" onresize="ResizeWaypoint(this)">
            <table id="waypointGrid" class="display compact" cellspacing="0" width="100%"> </table>
        </div>

        <script>
            function ResizeWaypoint(parent) {
                waypointGrid.fnAdjustColumnSizing(true);
                var st = waypointGrid.fnSettings();

                st.oScroll.sY = (parent.clientHeight - 28 - 24) + "px";
                waypointGrid.fnDraw();
            }

            var waypointGrid = (function () {
                function PrintHex(value) {
                    return ("00000000" + (value >>> 0).toString(16)).substr(-8);
                }

                var waypointGrid = $('#waypointGrid');

                waypointGrid.DataTable({
                    "paging" : false,
                    "scrollY" : "calc(100% - 28px)",
                    //"dom" : '<"fixed_height"t>',
                    "dom" : "t",
                    /*"responsive" : {
                        "details" : false
                    },*/
                    "deferRender" : true,
                    "data" : demoModel.GetWaypoints(),
                    "language": {
                        "emptyTable": "",
                        "infoEmpty": "",
                        "zeroRecords": ""
                    },
                    "columns" : [
                        { 
                            "title" : "Counter", 
                            "data" : "number"
                        }, { 
                            "title" : "Address", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintHex(row.address);
                                    default :
                                        return row.address;
                                };
                            }
                        }
                    ]
                });

                return waypointGrid.dataTable();

            })();
        </script>

        <div id="river_stack_window" caption="River Stack" class="river-stack-window"></div>
        <div id="track_stack_window" caption="Track Stack" class="track-stack-window"></div>
        <div id="execution_log_window" caption="Execution Log" class="execution-log-window"></div>

        <div id="inspector_window" caption="Inspector" class="inspector-window" onresize="ResizeInspector(this)">
            <table id="inspectorGrid" class="display compact" cellspacing="0" width="100%"> </table>
        </div>

        <script>
            function ResizeInspector(parent) {
                inspectorGrid.fnAdjustColumnSizing(true);
                var st = inspectorGrid.fnSettings();

                st.oScroll.sY = (parent.clientHeight - 28) + "px";
                inspectorGrid.fnDraw();
            }

            var inspectorGrid = (function () {
                function PrintHex(value) {
                    return ("00000000" + (value >>> 0).toString(16)).substr(-8);
                }

                function PrintBytes(value) {
                    var ret = "";

                    for (var i = 0; i < value.length; ++i) {
                        ret += ("00" + (value[i] >>> 0).toString(16)).substr(-2) + " ";
                    }

                    return ret;
                }

                var inspectorGrid = $('#inspectorGrid');

                inspectorGrid.DataTable({
                    "paging" : false,
                    "ordering" : false,
                    "scrollY" : "calc(100% - 28px)",
                    //"dom" : '<"fixed_height"t>',
                    "dom" : "t",
                    "autoWidth" : false,
                    /*"responsive" : {
                        "details" : false
                    },*/
                    "deferRender" : true,
                    "data" : [],
                    "language": {
                        "emptyTable": "",
                        "infoEmpty": "",
                        "zeroRecords": ""
                    },
                    "columns" : [
                        { 
                            "title" : "Address", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintHex(row.address);
                                    default :
                                        return row.address;
                                };
                            }
                        }, {
                            "title" : "Code",
                            "data" : "code"
                        }, { 
                            "title" : "Hex", 
                            "data" : function (row, type, val, meta) {
                                switch (type) {
                                    case "set" : 
                                        break;
                                    case "display" :
                                    case "filter" :
                                        return PrintBytes(row.hexString);
                                    default :
                                        return row.hexString;
                                };
                            }
                        }
                    ]
                });

                return inspectorGrid.dataTable();
             })();
        </script>

        <script type="html/x-acidjs-ribbon-template" id="styles_file_path">
            <div class="my-custom-style-file-path" data-tool-name="my-custom-styles">
                <ul data-tool="buttons" data-items="break" class="acidjs-ui-ribbon-tool-strip acidjs-ui-ribbon-tool-buttons" data-size="small">
                    <li>
                        <div>
                            <img width="24" height="24" src="AcidJs.Ribbon/icons/large/exe.png" style="vertical-align:middle" title="Path" />
                            <input type="text" value="<#= fileName #>" id="fileName" style="padding-right:70px; height:24px; width:300px;" />
                            <input type="file" accept=".exe" style="display:none;" id="exeFileInput" />
                            <a style="margin-left:-70px;" class="acidjs-ui-ribbon-tool" href="#" data-tool-name="browse" name="browse" title="Browse">
                                <img width="16" height="16" src="<#= icon #>" />
                                <span>Browse</span>
                            </a>
                        </div>
                    </li>
                    <li>
                        <div>
                            <img width="24" height="24" src="AcidJs.Ribbon/icons/large/cmd.png" style="margin-top:8px; vertical-align:middle" title="Command line" />
                            <input type="text" value="<#= commandLine #>" style="height:24px; width:300px;" />
                        </div>
                    </li>
                </ul>
            </div>
        </script>

        <script type="html/x-acidjs-ribbon-template" id="environment_variables">
            <textarea class="environment-area"><#= environment #></textarea>
        </script>

        <script type="html/x-acidjs-ribbon-template" id="my_custom_dropdown_template">
            <h5><#= title #></h5>
            <p><#= text #></p>
            <ul class="my-custom-dropdown-tool">
                <# for(var i = 0; i < guitars.length; i ++) { #>
                    <li>
                        <a href="#" data-value="<#= guitars[i] #>" name="guitar"><#= guitars[i] #></a>
                    </li>
                <# } #>
            </ul>
        </script>

        <!-- register control's runtime libraries -->
        <!--<script src="AcidJs.Ribbon/lib/jquery-2.1.3.min.js"></script>-->
        <script src="AcidJs.Ribbon/classes/Ribbon.js"></script>
        <!-- / register control's runtime libraries -->

        <script src="DockSpawn/js/dockspawn.js"></script>
            
        <script>
        (function() {
            
            "use strict";

            window.ribbon1 = new window.AcidJs.Ribbon({
                //appIconUrl: "my-custom-app-icon.png", // {String} [optional] top left application icon
                flat: true, // {Boolean} [optional] applies flat ribbon styles as in MS Office 2013 and above
                boundingBox: $("#ribbon-01"), // {jQueryDomObject} [required] ribbon bar placeholder element
                cssClasses: [ // {Array} [optional] additional CSS classes to be applied to the boundingBox. Default: []
                    "css-class-abc",
                    "css-class-def",
                    "css-class-ghi"
                ],
                ng: { // {Object} support for AngularJs directives
                    app: "",
                    show: "",
                    init: ""
                },
                //loadCss: false, // {Boolean} [optional] if set to false, the stylesheet of the ribbon will not be loaded from the control, but you will have to register it on the page via the <link /> tag
                //appRoot: "nested/folder/", // {String} [optional] by default, URLS of the ribbon are resolved from the root. Here you can specify different folder
                width: "100%", // {String} [optional] width (max-width) of the ribbon in pixels of percentage. default: "100%"
                minwidth: "auto", // {String} [optional] min-width of the ribbon in pixels of percentage. default: "auto"
                config: {
                    defaultSelectedTab: 0, // {Number} [optional] default selected tab, default: 0
                    fileTabMenu: [{ // {Object} [optional] file tab menu commands
                            hint: "Click to see the file menu", // {String} [optional] hint for the header item
                            name: "file", // {String} [required] menu name
                            label: "File",
                            icon: "save.png"// {String} [optional] menu item command icon
                        }],
                    quickLaunchToolbar: [],
                    tabs: [{
                        label: "Process", // {String} [required] label for the tab button
                        hint: "Go home", // {String} [optional] label for the tab button
                        name: "tab-home", // {String} [optional] id of the tab. if not set, a GUID will be used
                        enabled: true, // {Boolean} [optional] default: true
                        visible: true, // {Boolean} [optional] default: true
                        ribbons: [{
                            label: "Basic", // {String} [required]
                            hint: "Basic process configuration",
                            width: "345px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "345px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools: [{
                                type: "custom",
                                templateId: "styles_file_path",  // [required] on-page template in a 
                                data: { // required
                                    commandName: "my-custom-style-file-path",
                                    fileName: demoModel.GetExeName(),
                                    commandLine: demoModel.GetCmdLine(),
                                    icon: "AcidJs.Ribbon/icons/small/browse.png"
                                }
                            }]
                        }, {
                            label: "Advanced",
                            hint: "More process porperties",
                            width: "160px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "160px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools:[{
                                type: "custom-dropdown",
                                //size: "large",
                                width: "auto",
                                label: "Environment variables", // {String} [optional] button label
                                icon: "environment.png", // {String} [optional] button icon
                                hint: "Process environment variables", // {String} [optional] button tooltip
                                name: "my-custom-dropdown-environment-variables", // {String} [required] tool identifier
                                templateId: "environment_variables",
                                data: {
                                    environment: demoModel.GetEnvironmentVariables()
                                }
                            }]
                        }, {
                            label: ""
                        }]
                    },{
                        label: "Execution",
                        name: "tab-execution",
                        enabled: true,
                        visible: true,
                        ribbons: [{
                            label: "Execution",
                            width: "120px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "120px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools:[{
                                type: "buttons", // {String} [required] tool identifier
                                size: "large", // {String} [required] "small" | "large"
                                items: "break", // {String} [optional] "break" | "floated" items flow. default: "floated"
                                commands: [{
                                    name: "create", // required
                                    hint: "Create Process", // optional
                                    label: "Create", // optional
                                    icon: "create.png", // required
                                },{
                                    name: "terminate",
                                    hint: "Terminate Process",
                                    label: "Terminate",
                                    icon: "terminate.png"
                                }]
                            }]
                        },{
                            label: "Debugging",
                            width: "240px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "240px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools:[{
                                type: "buttons", // {String} [required] tool identifier
                                size: "large", // {String} [required] "small" | "large"
                                items: "break", // {String} [optional] "break" | "floated" items flow. default: "floated"
                                commands: [{
                                    name: "backward", // required
                                    hint: "Backward", // optional
                                    label: "Step backward", // optional
                                    icon: "backward.png", // required
                                },{
                                    name: "begin",
                                    hint: "Back to process start",
                                    label: "Begin",
                                    icon: "begin.png"
                                }]
                            },{
                                type: "buttons", // {String} [required] tool identifier
                                size: "large", // {String} [required] "small" | "large"
                                items: "break", // {String} [optional] "break" | "floated" items flow. default: "floated"
                                commands: [{
                                    name: "forward", // required
                                    hint: "Forward", // optional
                                    label: "Step Forward", // optional
                                    icon: "forward.png", // required
                                },{
                                    name: "end",
                                    hint: "Run to process end",
                                    label: "End",
                                    icon: "end.png"
                                }]
                            }]
                        },{
                            label: "Control",
                            width: "130px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "130px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools: [{
                                type: "buttons",
                                size: "small",
                                items: "break",
                                commands: [{
                                    name: "add_waypoint",
                                    label: "Add waypoint here",
                                    icon: "waypoints.png"
                                }]
                            }]
                        },{
                            label: ""
                        }]
                    },{
                        label: "Views",
                        name: "tab-views",
                        enabled: true,
                        visible: true,
                        ribbons: [{
                            label: "Process",
                            width: "120px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "120px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools:[{
                                type: "toggle-buttons", // {String} [required] tool identifier
                                size: "small", // {String} [required] "small" | "large"
                                items: "break", // {String} [optional] "break" | "floated" items flow. default: "floated"
                                commands: [{
                                    name: "modules", // required
                                    label: "Modules", // optional
                                    icon: "modules.png", // required
                                },{
                                    name: "address_space",
                                    label: "Address space",
                                    icon: "address-space.png"
                                },{
                                    name: "modules", // required
                                    label: "Registers", // optional
                                    icon: "registers.png", // required
                                }]
                            }]
                        },{
                            label: "Execution Control",
                            width: "120px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "120px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools:[{
                                type: "toggle-buttons", // {String} [required] tool identifier
                                size: "small", // {String} [required] "small" | "large"
                                items: "break", // {String} [optional] "break" | "floated" items flow. default: "floated"
                                commands: [{
                                    name: "breakpoints", // required
                                    label: "Breakpoints", // optional
                                    icon: "breakpoints.png", // required
                                },{
                                    name: "waypoints",
                                    label: "Waypoints",
                                    icon: "waypoints.png"
                                }]
                            }]
                        },{
                            label: "Internal Debugging",
                            width: "120px", // {Number|String} [optional] width of the ribbon in pixels, percentage, etc. default: "auto"
                            minWidth: "120px", // {Number|String} [optional] min width of the ribbon in pixels or percentage
                            tools:[{
                                type: "toggle-buttons", // {String} [required] tool identifier
                                size: "small", // {String} [required] "small" | "large"
                                items: "break", // {String} [optional] "break" | "floated" items flow. default: "floated"
                                commands: [{
                                    name: "river_stack", // required
                                    label: "River Stack", // optional
                                    icon: "river-stack.png", // required
                                },{
                                    name: "track_stack",
                                    label: "Track Stack",
                                    icon: "track-stack.png"
                                },{
                                    name: "execution_log",
                                    label: "Execution Log",
                                    icon: "execution-log.png"
                                }]
                            }]
                        },{
                            label: ""
                        }]
                    }]
                }
            });
            
            demoModel.on("ExeNameChanged", function() {
                var fName = document.getElementById("fileName");
                fName.value = demoModel.GetExeName();
            });

            
            function BrowseFile() {
                var ipt = document.getElementById("exeFileInput");
                ipt.addEventListener("change", function(evt) {
                    demoModel.SetExeName(this.value);
                }, false);
                ipt.click();
            }

            window.ribbon1.getBoundingBox().on("acidjs-ribbon-tool-clicked", function(e, data){
                window.console.info("acidjs.ribbon event fired", e.type, data);

                switch (data.command) {
                    case "create" :
                        demoModel.Create();
                        break;
                    case "terminate" :
                        demoModel.Control(2);
                        break;
                    case "backward" :
                        demoModel.Control(1);
                        break;
                    case "forward" :
                        demoModel.Control(0);
                        break;
                    case "begin" :
                        demoModel.GoToBegin();
                        break;
                    case "end" :
                        demoModel.GoToEnd();
                        break;
                    case "browse" :
                        BrowseFile();
                        break;
                    case "add_waypoint" :
                        demoModel.CreateWaypoint();
                        break;
                }
            });
            
            window.ribbon1.getBoundingBox().on("acidjs-ribbon-tab-changed", function(e, data){
                window.console.info("acidjs.ribbon event fired", e.type, data);
            });
            
            window.ribbon1.getBoundingBox().on("acidjs-ribbon-toggle", function(e, data){
                window.console.info("acidjs.ribbon event fired", e.type, data);
            });
            
            window.ribbon1.getBoundingBox().on("acidjs-ribbon-ready", function(e, data){
                window.console.info("acidjs.ribbon event fired", e.type, data);
                
                // set highlighted tabs group
                //window.ribbon1._later(function() {
                    //window.ribbon1.highlightTabsGroup(["tab-insert", "tab-page-layout"], "font-tools", "Font Tools", "#f00");
                    //window.ribbon1.highlightTabsGroup(["tab-draw", "tab-something-layout"], "table-tools", "Table Tools", "#006ac1");
                //}, 2000);
                
                // disable the ribbon on ready
                //window.ribbon1.disableRibbon();
                
                // hide the ribbon on ready
                //window.ribbon1.hide();
                
                // collapse the ribbon on ready
                //window.ribbon1.collapse();
                
                // set some tools as active on ready
                window.ribbon1.setToolsActive(demoModel.GetVisibleTools());
                

                var stateChangeRibbon = function(newModel) {
                    /*EXECUTION_NEW : 0x00,
                    EXECUTION_INITIALIZED : 0x01,
                    EXECUTION_SUSPENDED_AT_START : 0x02,
                    EXECUTION_RUNNING : 0x03,
                    EXECUTION_SUSPENDED : 0x04,
                    EXECUTION_SUSPENDED_AT_TERMINATION : 0x05,
                    EXECUTION_TERMINATED : 0x06,
                    EXECUTION_ERR : 0xFF*/

                    var enabledTools = {
                        '0'   : [],
                        '1'   : ["create"],
                        '2'   : ["terminate", "forward", "end", "add_waypoint"],
                        '3'   : [],
                        '4'   : ["terminate", "backward", "begin", "forward", "end", "add_waypoint"],
                        '5'   : ["terminate", "backward", "begin"],
                        '6'   : ["create"], // maybe
                        '255' : []
                    };
                    
                    var st = newModel.GetState();

                    window.ribbon1.disableTools([
                        "create", "terminate",
                        "backward", "begin",
                        "forward", "end",
                        "add_waypoint"
                    ]);

                    window.ribbon1.enableTools(enabledTools[st.toString()]);
                };

                demoModel.on("StateChanged", stateChangeRibbon);
                stateChangeRibbon(demoModel);

                var disasm = new Disassembler();

                demoModel.on("CurrentIPChanged", function(newModel) {
                    var eip = newModel.GetRegisters().eip;
                
                    var m = document.getElementById("reg_eip");
                    m.innerText = eip["value"];
                    m.className = eip["class"];

                    if (0 == eip.number) {
                        inspectorGrid.fnClearTable();
                        return;
                    }


                    var memoryMap = newModel.GetMemoryMap();

                    var memoryModel = undefined;

                    for (var i = 0; i < memoryMap.length; ++i) {
                        if ((eip.number >= memoryMap[i].baseAddress) && (eip.number < memoryMap[i].baseAddress + memoryMap[i].regionSize)) {
                            memoryModel = demoModel.GetMemoryModel(memoryMap[i].baseAddress, memoryMap[i].regionSize);
                            break;
                        }
                    }

                    if ("undefined" !== typeof memoryModel) {
                        var instr = disasm.Disassemble(memoryModel.memory, memoryModel.address, eip.number - memoryModel.address, 1);
                        //inspectorGrid.setData(instr.instructions);

                        var tmp = [];

                        for (var i = 0; i < instr.instructions.length; ++i) {
                            tmp.push({
                                address : instr.instructions[i].offset + memoryModel.address,
                                code : PrintInstruction(instr.instructions[i]),
                                hexString : memoryModel.memory.slice(
                                    instr.instructions[i].offset, 
                                    instr.instructions[i].offset + instr.instructions[i].size
                                ) 
                            });
                        }

                        inspectorGrid.fnClearTable();
                        if (0 < tmp.length) {
                            inspectorGrid.fnAddData(tmp);
                        }
                    }
                });

                demoModel.on("RegistersChanged", function(newModel) {
                    var registers = newModel.GetRegisters();

                    for (var r in registers) {
                        var m = document.getElementById("reg_" + r);
                        m.innerText = registers[r]["value"];
                        m.className = registers[r]["class"];
                    }

                });

                demoModel.on("MemoryMapChanged", function(newModel) {
                    var memoryMap = newModel.GetMemoryMap();

                    memoryGrid.fnClearTable();
                    if (0 < memoryMap.length) {
                        memoryGrid.fnAddData(memoryMap);
                    }
                });

                demoModel.on("ModulesChanged", function(newModel) {
                    var modules = newModel.GetModules();

                    modulesGrid.fnClearTable();
                    if (0 < modules.length) {
                        modulesGrid.fnAddData(modules);
                    }
                });

                demoModel.on("BreakpointsChanged", function(newModel) {
                    var breakpoints = newModel.GetBreakpoints();

                    breakpointGrid.fnClearTable();
                    if (0 < breakpoints.length) {
                        breakpointGrid.fnAddData(breakpoints);
                    }
                });

                demoModel.on("WaypointsChanged", function(newModel) {
                    var waypoints = newModel.GetWaypoints();

                    waypointGrid.fnClearTable();
                    if (0 < waypoints.length) {
                        waypointGrid.fnAddData(waypoints);
                    }
                });
            });
        
            window.ribbon1.getBoundingBox().on("acidjs-ribbon-ready", function(e, data){
                var divDockManager = document.getElementById("docking");
                window.dockManager = new dockspawn.DockManager(divDockManager);
                dockManager.initialize();
                // Let the dock manager element fill in the entire screen
                var onResized = function(e)
                {
                    dockManager.resize(
                        window.innerWidth - (
                            divDockManager.clientLeft + 
                            divDockManager.offsetLeft
                        ) - 2, 
                        window.innerHeight - (
                            divDockManager.clientTop + 
                            divDockManager.offsetTop
                        ) - 1
                    );

                    //memoryGrid.resizeCanvas();
                }
                window.onresize = onResized;
                $("#ribbon-01").on('resize', function() {
                    console.log("HERE");
                });
                setTimeout(function() {onResized(null);}, 200);

                $(".environment-area").click(function(event) {
                    event.stopPropagation();
                    return false;
                })

                // Convert existing elements on the page into "Panels".
                // They can then be docked on to the dock manager
                // Panels get a titlebar and a close button, and can also be
                // converted to a floating dialog box which can be dragged / resized

                var panels = {
                    modules: new dockspawn.PanelContainer(document.getElementById("modules_window"), dockManager),
                    address_space: new dockspawn.PanelContainer(document.getElementById("address_space_window"), dockManager),
                    registers: new dockspawn.PanelContainer(document.getElementById("registers_window"), dockManager),
                    breakpoints: new dockspawn.PanelContainer(document.getElementById("breakpoints_window"), dockManager),
                    waypoints: new dockspawn.PanelContainer(document.getElementById("waypoints_window"), dockManager),
                    river_stack: new dockspawn.PanelContainer(document.getElementById("river_stack_window"), dockManager),
                    track_stack: new dockspawn.PanelContainer(document.getElementById("track_stack_window"), dockManager),
                    execution_log: new dockspawn.PanelContainer(document.getElementById("execution_log_window"), dockManager),
                    inspector: new dockspawn.PanelContainer(document.getElementById("inspector_window"), dockManager)
                };

                var documentNode = dockManager.context.model.documentManagerNode;
                var nodes = {};

                nodes.modules = dockManager.dockDown(documentNode, panels.modules, 0.15);
                nodes.address_space = dockManager.dockFill(nodes.modules, panels.address_space);
                nodes.registers = dockManager.dockLeft(documentNode, panels.registers, 0.10);
                nodes.breakpoints = dockManager.dockRight(nodes.modules, panels.breakpoints, 0.30);
                nodes.waypoints = dockManager.dockFill(nodes.breakpoints, panels.waypoints);
                nodes.river_stack = dockManager.dockRight(documentNode, panels.river_stack, 0.15);
                nodes.track_stack = dockManager.dockFill(nodes.river_stack, panels.track_stack);
                nodes.execution_log = dockManager.dockFill(nodes.river_stack, panels.execution_log);
                nodes.inspector = dockManager.dockFill(documentNode, panels.inspector);
            });


            window.ribbon1.init();
        })();

        </script>
    </div>
    <script src="script.js"></script>
</body>
</html>